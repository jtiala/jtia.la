<!doctype html><html lang=en-us><head><title>Utilizing state machines in front-end development - jtia.la</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.139.3"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Joonas Tiala"><meta name=description content="The state machine is a very old concept. In fact, it even precedes modern computers. Despite its respectable age, the state machine is a super useful computational model to have in your toolbox of modern web development."><link rel=stylesheet href=https://jtia.la/css/index.min.35129d8199f43eee20ba9fc3b2238f20b5fc43fb6838c4faab3903adbec14c39.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Hepta+Slab:wght@1..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Victor+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel=stylesheet><script async src="https://www.googletagmanager.com/gtag/js?id=G-MPSXQ3Q7GG"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MPSXQ3Q7GG")}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jtia.la/posts/2022-09-14-utilizing-state-machines-in-front-end-development/dimmable-light-switch.png"><meta name=twitter:title content="Utilizing state machines in front-end development"><meta name=twitter:description content="The state machine is a very old concept. In fact, it even precedes modern computers. Despite its respectable age, the state machine is a super useful computational model to have in your toolbox of modern web development."><meta name=twitter:site content="@tjiala"><meta property="og:url" content="https://jtia.la/posts/2022-09-14-utilizing-state-machines-in-front-end-development/"><meta property="og:site_name" content="jtia.la"><meta property="og:title" content="Utilizing state machines in front-end development"><meta property="og:description" content="The state machine is a very old concept. In fact, it even precedes modern computers. Despite its respectable age, the state machine is a super useful computational model to have in your toolbox of modern web development."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-14T00:00:00+00:00"><meta property="article:modified_time" content="2022-09-14T00:00:00+00:00"><meta property="article:tag" content="State Machines"><meta property="article:tag" content="Statecharts"><meta property="article:tag" content="Xstate"><meta property="article:tag" content="JavaScript"><meta property="article:tag" content="TypeScript"><meta property="og:image" content="https://jtia.la/posts/2022-09-14-utilizing-state-machines-in-front-end-development/dimmable-light-switch.png"></head><body><main class=main><nav class=breadcrumb aria-label=Breadcrumb><ol><li><a href=https://jtia.la/>jtia.la</a></li><li><a href=https://jtia.la/posts/>Posts</a></li><li class=active><a href=https://jtia.la/posts/2022-09-14-utilizing-state-machines-in-front-end-development/ aria-current=page>Utilizing state machines in front-end development</a></li></ol></nav><article class=single><header><h1>Utilizing state machines in front-end development</h1><aside><div class=column><section><span class=title>Publish date</span>
<span>Sep 14, 2022</span></section><section><span class=title>Reading time</span>
<span>16 minutes</span></section></div><div class=column><section><h2 class=title>Tags</h2><ul class=link-list><li><a href=/tags/state-machines><iconify-icon icon=fa6-solid:tag aria-hidden=true></iconify-icon>state machines</a></li><li><a href=/tags/statecharts><iconify-icon icon=fa6-solid:tag aria-hidden=true></iconify-icon>statecharts</a></li><li><a href=/tags/xstate><iconify-icon icon=fa6-solid:tag aria-hidden=true></iconify-icon>xstate</a></li><li><a href=/tags/javascript><iconify-icon icon=fa6-solid:tag aria-hidden=true></iconify-icon>JavaScript</a></li><li><a href=/tags/typescript><iconify-icon icon=fa6-solid:tag aria-hidden=true></iconify-icon>TypeScript</a></li></ul></section><section><h2 class=title>Links</h2><ul class=link-list><li><a href=https://dev.solita.fi/2022/09/14/utilizing-state-machines-in-front-end-development.html target=_blank><iconify-icon icon=fa6-solid:link aria-hidden=true></iconify-icon>Read this article in Solita Dev Blog</a></li></ul></section></div><div class=column><section class=table-of-contents><h2 class=title>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#what-are-finite-state-machines>What are finite state machines?</a></li><li><a href=#statecharts-help-to-model-complicated-systems>Statecharts help to model complicated systems</a></li><li><a href=#im-coding-forms-and-list-views-not-traffic-lights-why-should-i-care>I&rsquo;m coding forms and list views, not traffic lights. Why should I care?</a></li><li><a href=#state-machines-to-the-rescue>State machines to the rescue</a></li><li><a href=#enter-xstate>Enter XState</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#recommended-reading>Recommended reading</a></li></ul></nav></section></div></aside></header><div class=content><p>The state machine is a very old concept. In fact, it even precedes modern computers. Despite its respectable age, the state machine is a super useful computational model to have in your toolbox of modern web development. Recently, there has been a lot of buzz around state machines and especially a popular state machine library called <a href=https://xstate.js.org>XState</a>.</p><p>In this blog post, I&rsquo;ll give you a brief 101 lecture on state machines and their extension, statecharts. After that, we&rsquo;ll take a look at some real-world examples of how to use state machines in a React web app context.</p><h2 id=what-are-finite-state-machines>What are finite state machines?<a class=heading-permalink href=#what-are-finite-state-machines><span class=sr-only>Permalink to What are finite state machines?</span><span aria-hidden=true>#</span></a></h2><p>Let us start with some theory. If you have studied computer science, you might remember this stuff from class. And even if not, you still might have heard the term <em>Finite State Machine</em> or <em>FSM</em> for short.</p><p>So, what are the FSMs? According to <a href=https://en.wikipedia.org/wiki/Finite-state_machine>Wikipedia</a>, an FSM is&mldr;</p><blockquote><p>&mldr; an abstract machine that can be in <strong>exactly one</strong> of a finite number of states at any given time. The FSM can <strong>change from one state to another</strong> in response to some inputs; the change from one state to another is called a transition. An FSM is defined by a list of its <strong>states</strong>, its <strong>initial state</strong>, and the <strong>inputs that trigger each transition</strong>.</p></blockquote><p>A lot of jargon, I know. To put it simply, state machines are abstractions that are used to describe the behavior of some system, which might be an algorithm in your web app, a physical device in real life, or the whole solar system.</p><p>One of the nicest things about state machines is that they are convenient to present visually. For example, let&rsquo;s take a look at a state machine representing a simplified version of a traffic light.</p><p><img src=simple-traffic-light.png alt="A visual presentation of a state machine representing a simple traffic light"></p><p>In most countries, there&rsquo;s a combined <code>red-yellow</code> state, but in this simplified version, the machine has three different <em>states</em>: <code>green</code>, <code>yellow</code>, and <code>red</code>. It can be in only one of these states at one time. On the left, the little dot with an arrow pointing to the green state marks <em>the initial state</em> of the machine. Meaning that the green state is activated when the machine is executed.</p><p>The arrows between states are the possible <em>transitions</em>. In this very simple machine, every state has only one possible transition. The pill-shaped boxes are <em>the external inputs</em> that trigger the transitions. This machine only has one input called <code>timer</code>, that triggers a transition from one state to another. Notice how the same input triggers a transition to a different state based on the current state: when the machine is in the yellow state, <code>timer</code> transitions the machine to the red state, and from the red state, it goes to the green state when a new <code>timer</code> input occurs.</p><p>Sweet. Now here&rsquo;s a little bit more complicated state machine. This one is for a dimmable light switch:</p><p><img src=dimmable-light-switch.png alt="A visual presentation of a state machine representing a dimmable light switch"></p><p>We have a couple of new concepts here. First, when we enter the initial state <code>off</code>, we immediately trigger <em>an action</em> called <code>setBrightness(0)</code>. Actions are fire-and-forget side effects that don&rsquo;t affect the machine itself. This one is <em>an entry action</em>, meaning it will get triggered when the machine enters the state.</p><p>We could also have actions for exiting a state or actions to be launched while the machine is transitioning to another state.</p><p>When the machine is in the <code>on</code> state and gets triggered by <code>REDUCE_BRIGHTNESS</code> or <code>ADD_BRIGHTNESS</code> inputs, it will transition to the <code>dim</code> or the <code>brighten</code> state, respectively. Those states have entry actions that control the actual light IRL. After that, something called <em>a transient transition</em> occurs, meaning that the machine transitions to another state right away. So back to <code>on</code> state we go.</p><h2 id=statecharts-help-to-model-complicated-systems>Statecharts help to model complicated systems<a class=heading-permalink href=#statecharts-help-to-model-complicated-systems><span class=sr-only>Permalink to Statecharts help to model complicated systems</span><span aria-hidden=true>#</span></a></h2><p>When your state machine starts to grow, it can become a bit of a mess. <a href=https://statecharts.dev/state-machine-state-explosion.html>Statecharts.dev</a> has a good explanation of a problem dubbed <em>state explosion</em>. Long story short, state machines are great but cannot scale to more complex use cases very well. Statecharts build on top of state machines and add some new concepts like <em>parallel states</em>, <em>hierarchies</em>, and <em>guards</em>, just to name a few.</p><p>If we take the traffic light example from before and make it a bit more complicated, it might look something like this:</p><p><img src=complicated-traffic-light.png alt="A visual presentation of a state machine representing a complex traffic light"></p><p>The initial state of the machine is <code>offline</code>. When the <code>TURN_ON</code> input is sent to the machine, it transitions to the <code>red</code> state, which is a state machine of its own! It has its own states, initial state, transitions, and so on. When the parent machine reaches <code>red</code>, the child machine gets executed and starts from its initial state. The parent machine could wait for the child machine to reach its final state, but in this case, the parent keeps going at the same time while the timers make sure the correct lights are on at any given time.</p><h2 id=im-coding-forms-and-list-views-not-traffic-lights-why-should-i-care>I&rsquo;m coding forms and list views, not traffic lights. Why should I care?<a class=heading-permalink href=#im-coding-forms-and-list-views-not-traffic-lights-why-should-i-care><span class=sr-only>Permalink to I&rsquo;m coding forms and list views, not traffic lights. Why should I care?</span><span aria-hidden=true>#</span></a></h2><p>What a great question! Next, we&rsquo;ll learn how you could actually use state machines and statecharts in your front-end code.</p><p>Let&rsquo;s start with a simple React component called <code>SearchForm</code>. We&rsquo;ll store the <code>keyword</code> and the <code>results</code> in a basic <code>useState</code> state and render a <code>form</code> and the search results if any. Submitting the form fetches the results from our API.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#ff79c6>const</span> SearchForm <span style=color:#ff79c6>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [keyword, setKeyword] <span style=color:#ff79c6>=</span> useState(<span style=color:#f1fa8c>&#34;&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [results, setResults] <span style=color:#ff79c6>=</span> useState([]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> search <span style=color:#ff79c6>=</span> (event) =&gt; {
</span></span><span style=display:flex><span>    event.preventDefault();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fetchResults(keyword).then((results) =&gt; setResults(results));
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#ff79c6>form</span> <span style=color:#50fa7b>onSubmit</span><span style=color:#ff79c6>=</span>{search}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>input</span> <span style=color:#50fa7b>onChange</span><span style=color:#ff79c6>=</span>{(event) =&gt; setKeyword(event.target.value)} /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>button</span> <span style=color:#50fa7b>type</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;submit&#34;</span>&gt;Search&lt;/<span style=color:#ff79c6>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#ff79c6>form</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      {results.length <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> results.map((result) =&gt; &lt;<span style=color:#ff79c6>p</span>&gt;{result}&lt;/<span style=color:#ff79c6>p</span>&gt;)}
</span></span><span style=display:flex><span>      {results.length <span style=color:#ff79c6>===</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Sorry<span style=color:#ff79c6>!</span> No results.&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Great. The happy path is mostly covered, but what happens when the API fails for some reason? Let&rsquo;s add some error handling. We&rsquo;ll add a new <code>useState</code> for <code>hasError</code> and set the error if the fetch fails.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#ff79c6>const</span> SearchForm <span style=color:#ff79c6>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [keyword, setKeyword] <span style=color:#ff79c6>=</span> useState(<span style=color:#f1fa8c>&#34;&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [results, setResults] <span style=color:#ff79c6>=</span> useState([]);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [hasError, setHasError] <span style=color:#ff79c6>=</span> useState(<span style=color:#ff79c6>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> search <span style=color:#ff79c6>=</span> (event) =&gt; {
</span></span><span style=display:flex><span>    event.preventDefault();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    setHasError(<span style=color:#ff79c6>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fetchResults(keyword)
</span></span><span style=display:flex><span>      .then((results) =&gt; setResults(results))
</span></span><span style=display:flex><span>      .<span style=color:#ff79c6>catch</span>(() =&gt; setHasError(<span style=color:#ff79c6>true</span>));
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#ff79c6>form</span> <span style=color:#50fa7b>onSubmit</span><span style=color:#ff79c6>=</span>{search}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>input</span> <span style=color:#50fa7b>onChange</span><span style=color:#ff79c6>=</span>{(event) =&gt; setKeyword(event.target.value)} /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>button</span> <span style=color:#50fa7b>type</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;submit&#34;</span>&gt;Search&lt;/<span style=color:#ff79c6>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#ff79c6>form</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      {hasError <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Oh no<span style=color:#ff79c6>!</span>&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {results.length <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> results.map((result) =&gt; &lt;<span style=color:#ff79c6>p</span>&gt;{result}&lt;/<span style=color:#ff79c6>p</span>&gt;)}
</span></span><span style=display:flex><span>      {results.length <span style=color:#ff79c6>===</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Sorry<span style=color:#ff79c6>!</span> No results.&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>How about a loading state? We will probably want to show a spinner or something while the search is executing. Let&rsquo;s do that by adding yet another <code>useState</code> call, setting the loading state in the search function, disabling the button, and showing a message while the app is loading.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#ff79c6>const</span> SearchForm <span style=color:#ff79c6>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [keyword, setKeyword] <span style=color:#ff79c6>=</span> useState(<span style=color:#f1fa8c>&#34;&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [results, setResults] <span style=color:#ff79c6>=</span> useState([]);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [isLoading, setIsLoading] <span style=color:#ff79c6>=</span> useState(<span style=color:#ff79c6>false</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [hasError, setHasError] <span style=color:#ff79c6>=</span> useState(<span style=color:#ff79c6>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> search <span style=color:#ff79c6>=</span> (event) =&gt; {
</span></span><span style=display:flex><span>    event.preventDefault();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    setIsLoading(<span style=color:#ff79c6>true</span>);
</span></span><span style=display:flex><span>    setHasError(<span style=color:#ff79c6>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fetchResults(keyword)
</span></span><span style=display:flex><span>      .then((results) =&gt; setResults(results))
</span></span><span style=display:flex><span>      .<span style=color:#ff79c6>catch</span>(() =&gt; setHasError(<span style=color:#ff79c6>true</span>))
</span></span><span style=display:flex><span>      .<span style=color:#ff79c6>finally</span>(() =&gt; setIsLoading(<span style=color:#ff79c6>false</span>));
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#ff79c6>form</span> <span style=color:#50fa7b>onSubmit</span><span style=color:#ff79c6>=</span>{search}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>input</span> <span style=color:#50fa7b>onChange</span><span style=color:#ff79c6>=</span>{(event) =&gt; setKeyword(event.target.value)} /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>button</span> <span style=color:#50fa7b>type</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;submit&#34;</span> <span style=color:#50fa7b>disabled</span><span style=color:#ff79c6>=</span>{isLoading}&gt;
</span></span><span style=display:flex><span>          Search
</span></span><span style=display:flex><span>        &lt;/<span style=color:#ff79c6>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#ff79c6>form</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      {isLoading <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Searching...&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {hasError <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Oh no<span style=color:#ff79c6>!</span>&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {results.length <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> results.map((result) =&gt; &lt;<span style=color:#ff79c6>p</span>&gt;{result}&lt;/<span style=color:#ff79c6>p</span>&gt;)}
</span></span><span style=display:flex><span>      {results.length <span style=color:#ff79c6>===</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Sorry<span style=color:#ff79c6>!</span> No results.&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Nice. What does the search form look like before the user has searched anything? It just says &ldquo;Sorry, no results&rdquo;, right? We could add a new bit of state, that keeps track if the user has searched or not to address that.</p><p>By growing the app we are starting to encounter some corner cases that we need to think about. Could the <code>isLoading</code> and <code>hasError</code> boolean flags be both true at the same time? How about the new <code>hasSearched</code> flag? Which combinations of these three are possible and what should we print out for each combination? <strong>Every boolean flag we are adding multiplies the possible combinations, and every combination should be handled one way or another.</strong> Every bit of state makes the component more complicated and more difficult to comprehend.</p><p>So, how could we fix this? If you are thinking of state machines, you are correct!</p><h2 id=state-machines-to-the-rescue>State machines to the rescue<a class=heading-permalink href=#state-machines-to-the-rescue><span class=sr-only>Permalink to State machines to the rescue</span><span aria-hidden=true>#</span></a></h2><p>First, let&rsquo;s define the states the component can be in. We&rsquo;ll use a plain object for easier autocompletion and typo-proofing. If we were using TypeScript, a union type or an enum would work even better.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>const</span> states <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  INITIAL<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;INITIAL&#34;</span>,
</span></span><span style=display:flex><span>  LOADING<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;LOADING&#34;</span>,
</span></span><span style=display:flex><span>  FAILURE<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;FAILURE&#34;</span>,
</span></span><span style=display:flex><span>  NO_RESULTS<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;NO_RESULTS&#34;</span>,
</span></span><span style=display:flex><span>  SHOW_RESULTS<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;SHOW_RESULTS&#34;</span>,
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Now we can use just one variable for the current state and it will always be set to one of the predefined values. Generating the output is now much easier since we know all the possible states the component can be in. No more dozens of combinations or corner cases.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#ff79c6>const</span> SearchForm <span style=color:#ff79c6>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [state, setState] <span style=color:#ff79c6>=</span> useState(states.INITIAL);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [keyword, setKeyword] <span style=color:#ff79c6>=</span> useState(<span style=color:#f1fa8c>&#34;&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [results, setResults] <span style=color:#ff79c6>=</span> useState([]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> search <span style=color:#ff79c6>=</span> (event) =&gt; {
</span></span><span style=display:flex><span>    event.preventDefault();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    setState(states.LOADING);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fetchResults(keyword)
</span></span><span style=display:flex><span>      .then((results) =&gt; {
</span></span><span style=display:flex><span>        setResults(results);
</span></span><span style=display:flex><span>        setState(results.length <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>?</span> states.SHOW_RESULTS <span style=color:#ff79c6>:</span> states.NO_RESULTS);
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      .<span style=color:#ff79c6>catch</span>((error) =&gt; setState(states.FAILURE));
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#ff79c6>form</span> <span style=color:#50fa7b>onSubmit</span><span style=color:#ff79c6>=</span>{search}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>input</span> <span style=color:#50fa7b>onChange</span><span style=color:#ff79c6>=</span>{(event) =&gt; setKeyword(event.target.value)} /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>button</span> <span style=color:#50fa7b>type</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;submit&#34;</span> <span style=color:#50fa7b>disabled</span><span style=color:#ff79c6>=</span>{state <span style=color:#ff79c6>===</span> states.LOADING}&gt;
</span></span><span style=display:flex><span>          Search
</span></span><span style=display:flex><span>        &lt;/<span style=color:#ff79c6>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#ff79c6>form</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      {state <span style=color:#ff79c6>===</span> states.INITIAL <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Hi<span style=color:#ff79c6>!</span> Enter keyword please.&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state <span style=color:#ff79c6>===</span> states.LOADING <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Searching...&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state <span style=color:#ff79c6>===</span> states.FAILURE <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Oh no<span style=color:#ff79c6>!</span>&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state <span style=color:#ff79c6>===</span> states.NO_RESULTS <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Sorry<span style=color:#ff79c6>!</span> No results.&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state <span style=color:#ff79c6>===</span> states.SHOW_RESULTS <span style=color:#ff79c6>&amp;&amp;</span>
</span></span><span style=display:flex><span>        results.map((result) =&gt; &lt;<span style=color:#ff79c6>p</span>&gt;{result}&lt;/<span style=color:#ff79c6>p</span>&gt;)}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Much better already. But it&rsquo;s not quite a proper state machine yet. Referring to the definition of an FSM at the start of the blog post, we know that now our component can be only in one state of a finite set. We also transition to different states based on inputs. Our initial state is set. However, we haven&rsquo;t defined the conditions for each transition yet.</p><p>We could fix that by defining a list of possible transitions. While at it, let&rsquo;s add a utility function for checking if a transition from state <code>A</code> to <code>B</code> is valid.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>const</span> states <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  INITIAL<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;INITIAL&#34;</span>,
</span></span><span style=display:flex><span>  LOADING<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;LOADING&#34;</span>,
</span></span><span style=display:flex><span>  FAILURE<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;FAILURE&#34;</span>,
</span></span><span style=display:flex><span>  NO_RESULTS<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;NO_RESULTS&#34;</span>,
</span></span><span style=display:flex><span>  SHOW_RESULTS<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;SHOW_RESULTS&#34;</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> transitions <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  INITIAL<span style=color:#ff79c6>:</span> [<span style=color:#f1fa8c>&#34;LOADING&#34;</span>],
</span></span><span style=display:flex><span>  LOADING<span style=color:#ff79c6>:</span> [<span style=color:#f1fa8c>&#34;FAILURE&#34;</span>, <span style=color:#f1fa8c>&#34;NO_RESULTS&#34;</span>, <span style=color:#f1fa8c>&#34;SHOW_RESULTS&#34;</span>],
</span></span><span style=display:flex><span>  FAILURE<span style=color:#ff79c6>:</span> [],
</span></span><span style=display:flex><span>  NO_RESULTS<span style=color:#ff79c6>:</span> [],
</span></span><span style=display:flex><span>  SHOW_RESULTS<span style=color:#ff79c6>:</span> [],
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> isValidTransition <span style=color:#ff79c6>=</span> (before, after) =&gt;
</span></span><span style=display:flex><span>  transitions[before].includes(after);
</span></span></code></pre></div><p>In the component, we&rsquo;ll make sure that all the transitions are validated with the new utility function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#ff79c6>const</span> SearchForm <span style=color:#ff79c6>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [state, setState] <span style=color:#ff79c6>=</span> useState(states.INITIAL);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [keyword, setKeyword] <span style=color:#ff79c6>=</span> useState(<span style=color:#f1fa8c>&#34;&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [results, setResults] <span style=color:#ff79c6>=</span> useState([]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> search <span style=color:#ff79c6>=</span> (event) =&gt; {
</span></span><span style=display:flex><span>    event.preventDefault();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (isValidTransition(state, states.LOADING)) {
</span></span><span style=display:flex><span>      setState(states.LOADING);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      fetchResults(keyword)
</span></span><span style=display:flex><span>        .then((results) =&gt; {
</span></span><span style=display:flex><span>          setResults(results);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>const</span> nextState <span style=color:#ff79c6>=</span>
</span></span><span style=display:flex><span>            results.length <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>?</span> states.SHOW_RESULTS <span style=color:#ff79c6>:</span> states.NO_RESULTS;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>if</span> (isValidTransition(state, nextState)) {
</span></span><span style=display:flex><span>            setState(nextState);
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#ff79c6>catch</span>((error) =&gt; {
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>if</span> (isValidTransition(state, states.FAILURE)) {
</span></span><span style=display:flex><span>            setState(states.FAILURE);
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#ff79c6>form</span> <span style=color:#50fa7b>onSubmit</span><span style=color:#ff79c6>=</span>{search}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>input</span> <span style=color:#50fa7b>onChange</span><span style=color:#ff79c6>=</span>{(event) =&gt; setKeyword(event.target.value)} /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>button</span> <span style=color:#50fa7b>type</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;submit&#34;</span> <span style=color:#50fa7b>disabled</span><span style=color:#ff79c6>=</span>{state <span style=color:#ff79c6>===</span> states.LOADING}&gt;
</span></span><span style=display:flex><span>          Search
</span></span><span style=display:flex><span>        &lt;/<span style=color:#ff79c6>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#ff79c6>form</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      {state <span style=color:#ff79c6>===</span> states.INITIAL <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Hi<span style=color:#ff79c6>!</span> Enter keyword please.&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state <span style=color:#ff79c6>===</span> states.LOADING <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Searching...&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state <span style=color:#ff79c6>===</span> states.FAILURE <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Oh no<span style=color:#ff79c6>!</span>&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state <span style=color:#ff79c6>===</span> states.NO_RESULTS <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Sorry<span style=color:#ff79c6>!</span> No results.&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state <span style=color:#ff79c6>===</span> states.SHOW_RESULTS <span style=color:#ff79c6>&amp;&amp;</span>
</span></span><span style=display:flex><span>        results.map((result) =&gt; &lt;<span style=color:#ff79c6>p</span>&gt;{result}&lt;/<span style=color:#ff79c6>p</span>&gt;)}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Not too shabby. Now we pretty much have a finite state machine in place and the code is much easier to comprehend, extend, and refactor. Our component and the whole imaginary app could be improved a lot pretty easily by just following the specification of finite state machines, and doing the work by hand. FSMs have a lot more features we haven&rsquo;t implemented yet, so it might be worth our while to take a look at some open-source libraries that help us implement state machines.</p><h2 id=enter-xstate>Enter XState<a class=heading-permalink href=#enter-xstate><span class=sr-only>Permalink to Enter XState</span><span aria-hidden=true>#</span></a></h2><p><a href=https://xstate.js.org>XState</a> is one of the most popular state machine libraries out there for the JavaScript/TypeScript world. It can be used pretty much with any stack you choose and it comes with official utilities for React, Vue, and Svelte. XState allows us to create state machines and statecharts using a configuration object and also execute them.</p><p>Let&rsquo;s refactor the search form to use XState instead of our own FSM implementation. The visual representations of the state machine could look something like this:</p><p><img src=search-form-with-xstate-v1.png alt="A visual presentation of a state machine representing a search form on a web app"></p><p>From the initial state, we transition to <code>loading</code> when <code>search</code> input happens, in our case when the form is submitted. Depending on the result of the fetching (which is not part of the machine), we transition to one of the three <em>final states</em>, indicated by the squares in front of the state name. A final state is a state, that doesn&rsquo;t have any transitions forward.</p><p>The XState configuration could look something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>import</span> { createMachine, assign } from <span style=color:#f1fa8c>&#34;xstate&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> searchFormMachine <span style=color:#ff79c6>=</span> createMachine(
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    id<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Search Form&#34;</span>,
</span></span><span style=display:flex><span>    initial<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;initial&#34;</span>,
</span></span><span style=display:flex><span>    states<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>      initial<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>        on<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>          SEARCH<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;loading&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      loading<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>        on<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>          SUCCESS<span style=color:#ff79c6>:</span> [
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>              cond<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;hasResults&#34;</span>,
</span></span><span style=display:flex><span>              target<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;showResults&#34;</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>              cond<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;hasNoResults&#34;</span>,
</span></span><span style=display:flex><span>              target<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;noResults&#34;</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>          ],
</span></span><span style=display:flex><span>          ERROR<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;failure&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      failure<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>        type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;final&#34;</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      noResults<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>        type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;final&#34;</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      showResults<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>        type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;final&#34;</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    guards<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>      hasResults<span style=color:#ff79c6>:</span> (context, event) =&gt; event.results.length <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>      hasNoResults<span style=color:#ff79c6>:</span> (context, event) =&gt; event.results.length <span style=color:#ff79c6>===</span> <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><p>First, we import the <code>createMachine</code> function from XState and pass our configuration object to it. The config has an ID of the machine, the initial state, and definitions of all the states. Each state definition contains all the possible transitions from the current state to some other state. For example, the <code>initial</code> state transitions to the <code>loading</code> state on a <code>SEARCH</code> event (XState calls inputs events).</p><p>The transitions can also be guarded by a condition. When the machine is in the <code>loading</code> state and receives a <code>SUCCESS</code> event, a conditional transition occurs. If the search function found some results, the machine is transitioned to the <code>showResults</code> state, otherwise to the <code>noResults</code> state. The guards are defined at the bottom of the config.</p><p>In the React component, we&rsquo;ll need to import the <code>useMachine</code> hook from XState&rsquo;s React utilities and our machine configuration. We&rsquo;ll call <code>useMachine</code> with the config and get the current state and a function to send events as a return. We can use these to replace our custom <code>useState</code> managed state and transitions. Instead of checking if a transition is valid and then calling <code>setState</code>, we can use <code>send</code> to send an event to the machine and let it handle the rest. Notice, that we can send data to the machine as part of the event. In the rendering section, we can get the current state from <code>state.value</code> and render the correct stuff accordingly.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#ff79c6>import</span> { useMachine } from <span style=color:#f1fa8c>&#34;@xstate/react&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> { searchFormMachine } from <span style=color:#f1fa8c>&#34;./searchFormMachine.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> SearchForm <span style=color:#ff79c6>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [state, send] <span style=color:#ff79c6>=</span> useMachine(searchFormMachine);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [keyword, setKeyword] <span style=color:#ff79c6>=</span> useState(<span style=color:#f1fa8c>&#34;&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [results, setResults] <span style=color:#ff79c6>=</span> useState([]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> search <span style=color:#ff79c6>=</span> (event) =&gt; {
</span></span><span style=display:flex><span>    event.preventDefault();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    send(<span style=color:#f1fa8c>&#34;SEARCH&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fetchResults(keyword)
</span></span><span style=display:flex><span>      .then((results) =&gt; {
</span></span><span style=display:flex><span>        setResults(results);
</span></span><span style=display:flex><span>        send({ type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;SUCCESS&#34;</span>, data<span style=color:#ff79c6>:</span> results });
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      .<span style=color:#ff79c6>catch</span>((error) =&gt; send(<span style=color:#f1fa8c>&#34;ERROR&#34;</span>));
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#ff79c6>form</span> <span style=color:#50fa7b>onSubmit</span><span style=color:#ff79c6>=</span>{search}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>input</span> <span style=color:#50fa7b>onChange</span><span style=color:#ff79c6>=</span>{(event) =&gt; setKeyword(event.target.value)} /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>button</span> <span style=color:#50fa7b>type</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;submit&#34;</span> <span style=color:#50fa7b>disabled</span><span style=color:#ff79c6>=</span>{state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;loading&#34;</span>}&gt;
</span></span><span style=display:flex><span>          Search
</span></span><span style=display:flex><span>        &lt;/<span style=color:#ff79c6>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#ff79c6>form</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      {state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;initial&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Hi<span style=color:#ff79c6>!</span> Enter keyword please.&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;loading&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Searching...&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;failure&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Oh no<span style=color:#ff79c6>!</span>&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;noResults&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Sorry<span style=color:#ff79c6>!</span> No results.&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;showResults&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span>
</span></span><span style=display:flex><span>        results.map((result) =&gt; &lt;<span style=color:#ff79c6>p</span>&gt;{result}&lt;/<span style=color:#ff79c6>p</span>&gt;)}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>We are not done yet. We can improve our code further by moving the keyword and the search results to the machine as well.</p><p>First, we define a <code>context</code> for the state machine, with empty initial values. In state machine talk, the context is called <code>extended state</code> but we can think as a data store for the machine.
Then we listen to the <code>SET_KEYWORD</code> event on the <code>initial</code> state. When it occurs, we assign its data to our machine&rsquo;s context. And on the <code>SUCCESS</code> event, we save the search results to the context.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>import</span> { createMachine, assign } from <span style=color:#f1fa8c>&#34;xstate&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> searchFormMachine <span style=color:#ff79c6>=</span> createMachine(
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    id<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Search Form&#34;</span>,
</span></span><span style=display:flex><span>    initial<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;initial&#34;</span>,
</span></span><span style=display:flex><span>    context<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>      keyword<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      results<span style=color:#ff79c6>:</span> [],
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    states<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>      initial<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>        on<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>          SEARCH<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;loading&#34;</span>,
</span></span><span style=display:flex><span>          SET_KEYWORD<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>            actions<span style=color:#ff79c6>:</span> assign({
</span></span><span style=display:flex><span>              keyword<span style=color:#ff79c6>:</span> (context, event) =&gt; event.keyword,
</span></span><span style=display:flex><span>            }),
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      loading<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>        on<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>          SUCCESS<span style=color:#ff79c6>:</span> [
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>              cond<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;hasResults&#34;</span>,
</span></span><span style=display:flex><span>              target<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;showResults&#34;</span>,
</span></span><span style=display:flex><span>              actions<span style=color:#ff79c6>:</span> assign({
</span></span><span style=display:flex><span>                results<span style=color:#ff79c6>:</span> (context, event) =&gt; event.results,
</span></span><span style=display:flex><span>              }),
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>              cond<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;hasNoResults&#34;</span>,
</span></span><span style=display:flex><span>              target<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;noResults&#34;</span>,
</span></span><span style=display:flex><span>              actions<span style=color:#ff79c6>:</span> assign({
</span></span><span style=display:flex><span>                results<span style=color:#ff79c6>:</span> (context, event) =&gt; [],
</span></span><span style=display:flex><span>              }),
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>          ],
</span></span><span style=display:flex><span>          ERROR<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;failure&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      failure<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>        type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;final&#34;</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      noResults<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>        type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;final&#34;</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      showResults<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>        type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;final&#34;</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    guards<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>      hasResults<span style=color:#ff79c6>:</span> (context, event) =&gt; event.results.length <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>      hasNoResults<span style=color:#ff79c6>:</span> (context, event) =&gt; event.results.length <span style=color:#ff79c6>===</span> <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><p>On the component, we may now remove the <code>useState</code> hooks for the <code>keyword</code> and the <code>results</code> and access the machine&rsquo;s context using <code>state.context</code>. We were already sending the results as part of the <code>SUCCESS</code> event, so no changes are required there. On the input field&rsquo;s <code>onChange</code> handler we can straight up call the <code>send</code> function and send the <code>SET_KEYWORD</code> event with the field value as data.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#ff79c6>import</span> { useMachine } from <span style=color:#f1fa8c>&#34;@xstate/react&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> { searchFormMachine } from <span style=color:#f1fa8c>&#34;./searchFormMachine.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> SearchForm <span style=color:#ff79c6>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [state, send] <span style=color:#ff79c6>=</span> useMachine(searchFormMachine);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> search <span style=color:#ff79c6>=</span> (event) =&gt; {
</span></span><span style=display:flex><span>    event.preventDefault();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    send(<span style=color:#f1fa8c>&#34;SEARCH&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fetchResults(state.context.keyword)
</span></span><span style=display:flex><span>      .then((results) =&gt; {
</span></span><span style=display:flex><span>        send({ type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;SUCCESS&#34;</span>, data<span style=color:#ff79c6>:</span> results });
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      .<span style=color:#ff79c6>catch</span>((error) =&gt; send(<span style=color:#f1fa8c>&#34;ERROR&#34;</span>));
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#ff79c6>form</span> <span style=color:#50fa7b>onSubmit</span><span style=color:#ff79c6>=</span>{search}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>input</span>
</span></span><span style=display:flex><span>          <span style=color:#50fa7b>onChange</span><span style=color:#ff79c6>=</span>{(event) =&gt;
</span></span><span style=display:flex><span>            send({ type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;SET_KEYWORD&#34;</span>, data<span style=color:#ff79c6>:</span> event.target.value })
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff79c6>button</span> <span style=color:#50fa7b>type</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;submit&#34;</span> <span style=color:#50fa7b>disabled</span><span style=color:#ff79c6>=</span>{state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;loading&#34;</span>}&gt;
</span></span><span style=display:flex><span>          Search
</span></span><span style=display:flex><span>        &lt;/<span style=color:#ff79c6>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#ff79c6>form</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      {state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;initial&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Hi<span style=color:#ff79c6>!</span> Enter keyword please.&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;loading&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Searching...&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;failure&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Oh no<span style=color:#ff79c6>!</span>&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;noResults&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span> &lt;<span style=color:#ff79c6>p</span>&gt;Sorry<span style=color:#ff79c6>!</span> No results.&lt;/<span style=color:#ff79c6>p</span>&gt;}
</span></span><span style=display:flex><span>      {state.value <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;showResults&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span>
</span></span><span style=display:flex><span>        state.context.results.map((result) =&gt; &lt;<span style=color:#ff79c6>p</span>&gt;{result}&lt;/<span style=color:#ff79c6>p</span>&gt;)}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#ff79c6>div</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Cool, now the component&rsquo;s whole state is handled by XState. We have successfully moved the business logic out from the view layer handled by React. We could even move the fetching to be a part of the machine (maybe a reusable sub-machine?). Adding more features should now be pretty easy, too. If we needed to only allow sending the form, if the <code>keyword</code> were at least 3 characters long, we could add a <code>guard</code> for the transition from <code>initial</code> to <code>loading</code>. Or add a transition from <code>initial</code> to a new state <code>readyForSubmitting</code>, once the conditions are met, and only allow <code>SEARCH</code> event on the newly added state.</p><p>And by the way, our machine looks like this now:</p><p><img src=search-form-with-xstate-v2.png alt="A visual presentation of a state machine representing a search form on a web app"></p><p>The <code>SET_KEYWORD</code> event assigns the data but doesn&rsquo;t trigger a transition while <code>SUCCESS</code> assigns and transitions at the same time.</p><h2 id=conclusion>Conclusion<a class=heading-permalink href=#conclusion><span class=sr-only>Permalink to Conclusion</span><span aria-hidden=true>#</span></a></h2><p>State machines and statecharts are super effective tools when used correctly. I especially like the fact that when using them I&rsquo;m forced to think about the behavior of the app and describe it before implementing it.</p><p>State machines add formalism and make code more robust by making sure there are no impossible states. They can separate business logic from the view layer and are a great way to make reusable logic. They are easy to represent visually, which can drastically help with communicating ideas, for example. State machines can replace other state management libraries, like Redux, or work alongside them.</p><p>On the other hand, state machines require you to think in a new mental model and can sometimes be a little overwhelming. A state machine with hundreds of lines of config code can seem like you are just moving your spaghetti from one plate to another. And you very well might be doing just that, but I still find organizing logic is much easier with state machines.</p><p>My recommendation: <strong>add state machines to your developer toolbox!</strong> Next time you are adding a third boolean flag to your component, think to yourself, &ldquo;Could this be a state machine instead?&rdquo;. I&rsquo;ll promise, soon you&rsquo;ll start to see state machines everywhere you look. You don&rsquo;t need to use any library at all, you don&rsquo;t even have to do a full-fledged FSM. Just replace multiple booleans with one state variable with multiple, predefined values and enjoy better quality code with fewer corner cases. If you decide to use a library, XState gets my vote.</p><h2 id=recommended-reading>Recommended reading<a class=heading-permalink href=#recommended-reading><span class=sr-only>Permalink to Recommended reading</span><span aria-hidden=true>#</span></a></h2><ul><li><a href=https://en.wikipedia.org/wiki/Finite-state_machine>Wikipedia: Finite-state machine</a> - In-depth article about FSMs and automata theory. A bit academic, but a good read nonetheless.</li><li><a href=https://statecharts.dev/>statecharts.dev</a> - A great little site about the world of statecharts.</li><li><a href=https://xstate.js.org>xstate.js.org</a> - XState documentation.</li><li><a href=https://xstate-catalogue.com>xstate-catalogue.com</a> - A curated collection of high-quality XState state machines. A great resource for inspiration.</li><li><a href=https://jtiala.github.io/speed-tester/>Speed Tester</a> (<a href=https://github.com/jtiala/speed-tester>GitHub</a>) - A simple game I made using XState and React. As seen on the TV game show <em>Speden Spelit</em>.</li></ul></div></article></main><aside class=sidebar><section class=hero><h2 class=title><a href=https://jtia.la/>jtia.la</a></h2><div class=author><img class=avatar src=/avatar.jpg alt><div class=details><span>Joonas Tiala</span>
<small>Software Developer</small></div></div><div class=social><a href=https://github.com/jtiala target=_blank rel="noreferrer noopener"><iconify-icon icon=fa6-brands:github aria-label=GitHub></iconify-icon></a><a href=https://bsky.app/profile/jtia.la target=_blank rel="noreferrer noopener"><iconify-icon icon=fa6-brands:bluesky aria-label=Bluesky></iconify-icon></a><a href=https://twitter.com/tjiala target=_blank rel="noreferrer noopener"><iconify-icon icon=fa6-brands:x-twitter aria-label=X></iconify-icon></a><a href=https://linkedin.com/in/jtiala target=_blank rel="noreferrer noopener"><iconify-icon icon=fa6-brands:linkedin aria-label=LinkedIn></iconify-icon></a><a href=mailto:joonas.tiala@gmail.com target=_blank rel="noreferrer noopener"><iconify-icon icon=fa6-solid:at aria-label=Email></iconify-icon></a></div></section></aside><script src=https://cdn.jsdelivr.net/npm/iconify-icon@2.1.0/dist/iconify-icon.min.js></script></body></html>